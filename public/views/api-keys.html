<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Keys - Document Generation API</title>
  <meta name="description" content="Manage your API keys for the Document Generation API">
  <meta name="theme-color" content="#e02337">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icons/favicon.light.svg" media="(prefers-color-scheme: light)">
  <link rel="icon" href="/icons/favicon.dark.svg" media="(prefers-color-scheme: dark)">
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  <link rel="stylesheet" href="/css/main.css">
  <script src="/js/register-sw.js"></script>
  <script type="module" src="/js/theme.js"></script>
  <script type="module" src="/js/main.js"></script>
  <script type="module" src="/js/components/api-key-manager.js"></script>
</head>
<body>
  <pf-header></pf-header>
  
  <div class="container">
    <div class="dashboard-tabs">
      <button class="tab-button active" data-tab="manage">Manage Keys</button>
      <button class="tab-button" data-tab="docs">API Documentation</button>
    </div>
    
    <div class="tab-content" id="manage-tab">
      <div id="api-key-container" class="api-key-container">
        <api-key-manager></api-key-manager>
      </div>
    </div>
  
  <div class="tab-content" id="docs-tab" style="display: none;">
    <div class="intro-section">
      <h2>About API Keys</h2>
      <p>API keys are used to authenticate your requests to the Document Generation API. Each key is associated with your account and can be used to access the API endpoints.</p>
      
      <h3>Best Practices</h3>
      <ul>
        <li>Create separate API keys for different environments (development, staging, production)</li>
        <li>Rotate your API keys periodically for enhanced security</li>
        <li>Deactivate or delete API keys that are no longer in use</li>
        <li>Never share your API keys or commit them to version control</li>
      </ul>
      
      <h3>Using Your API Keys</h3>
      <p>Include your API key in the request headers using one of the following methods:</p>
      <p><code>Authorization: Bearer pfs_your_api_key_here</code></p>
      <p>Or for backward compatibility:</p>
      <p><code>X-API-Key: your_email@example.com</code></p>
    </div>
  </div>
  
  <div id="login-prompt" class="login-prompt" style="display: none;">
    <h2>Authentication Required</h2>
    <p>You need to be logged in with an active subscription to manage API keys.</p>
    <a href="/subscription.html" class="login-button">Subscribe Now</a>
  </div>
  
  <pf-footer></pf-footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Check if user is logged in
      const apiKey = localStorage.getItem('api_key') || new URLSearchParams(window.location.search).get('api_key');
      
      if (!apiKey) {
        document.getElementById('api-key-container').style.display = 'none';
        document.getElementById('login-prompt').style.display = 'block';
      } else {
        document.getElementById('api-key-container').style.display = 'block';
        document.getElementById('login-prompt').style.display = 'none';
      }
      
      // Set up tab switching
      const tabButtons = document.querySelectorAll('.tab-button');
      tabButtons.forEach(button => {
        button.onclick = () => {
          console.log('Tab button clicked:', button.dataset.tab);
          
          // Remove active class from all buttons
          tabButtons.forEach(btn => btn.classList.remove('active'));
          
          // Add active class to clicked button
          button.classList.add('active');
          
          // Hide all tab content
          document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
          });
          
          // Show selected tab content
          const tabId = button.dataset.tab;
          const tabContent = document.getElementById(`${tabId}-tab`);
          
          if (tabContent) {
            tabContent.style.display = 'block';
            console.log('Tab content displayed:', tabId);
          } else {
            console.error('Tab content not found:', tabId);
          }
        };
      });
      
      // Force refresh of the API key manager component
      setTimeout(() => {
        const apiKeyManager = document.querySelector('api-key-manager');
        if (apiKeyManager) {
          // Try to force a re-render
          apiKeyManager.render();
          console.log('API key manager refreshed');
        }
      }, 500);
    });
  </script>
</body>
</html>